# 常用性能分析查询

- 查看当前数据库连接

  ```sql
  SELECT pg_stat_get_backend_pid(s.backendid) AS procpid, pg_stat_get_backend_activity(s.backendid) AS current_query FROM (SELECT pg_stat_get_backend_idset() AS backendid) AS s; 
  ```

  

- 查看当前正在运行sql 

  ```sql
  SELECT
      procpid,
      START,
      now() - START AS lap,
      current_query
  FROM
      (
          SELECT
              backendid,
              pg_stat_get_backend_pid (S.backendid) AS procpid,
              pg_stat_get_backend_activity_start (S.backendid) AS START,
              pg_stat_get_backend_activity (S.backendid) AS current_query
          FROM
              (
                  SELECT
                      pg_stat_get_backend_idset () AS backendid
              ) AS S
      ) AS S
  WHERE
      current_query <> '<IDLE>'
  ORDER BY
      lap DESC;
  ```

  